#!/usr/bin/env bash

echo "$(set | grep "REQUEST_")" >&2

content="$(cat << EndOfText
<svg 
width="100%" height="100%" 
xmlns="http://www.w3.org/2000/svg" 
xmlns:xlink="http://www.w3.org/1999/xlink"
version="1.1"
style="background: #888888"
onload="onLoaded(evt)"
>
<script type="application/ecmascript"><![CDATA[
function onLoaded(evt) {
  console.log("on loaded");
}
function init(evt) {
  //alert('HI init');
  console.log("init");
}
function sendRequest() {
  var xhr = new XMLHttpRequest;
  xhr.open('get','/log',true);
  xhr.onreadystatechange = function(){
    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
      console.log(xhr.response);
      console.log(xhr.responseText);
      //alert(xhr.response);
    }
  };
  xhr.send();
}
function clickAction(evt) {
  //alert('HI');
  sendRequest();
  var foo  = document.getElementById('foo_text');
  foo.textContent='ffff';
  foo.style.display = "none";
  console.log(foo);
  console.log(foo.textContent);
}
setTimeout(function() {
  sendRequest();
},100);

//]]></script>
  <g id="foo">
    <rect onclick="clickAction()" x="10" y="10" height="80" width="80" style="stroke:#ff0000; fill: #0000ff"/>
    <text id="foo_text" x="50" y="50" font-size="18" fill="#eeffee">
        bla
    </text>
  </g>
  <g id="bar">
    <rect onclick="clickAction()" x="10" y="10" height="80" width="80" style="stroke:#ff0000; fill: #0000ff"/>
    <text id="bar_text" x="50" y="50" font-size="18" fill="#eeffee">
        bla
    </text>
  </g>
</svg>
EndOfText
)"
echo_response_status_line
echo_response_default_headers
echo -e "Content-Type: image/svg+xml\r"
echo -e "Content-Length: ${#content}\r"
echo -e "\r"

echo "${content}"


